<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>複数人フォーム送信</title>
</head>
<body>
  <h2>複数人データ送信フォーム</h2>

  <div id="formContainer">
    <div class="person">
      <label>名前: <input type="text" name="name" required></label>
      <label>年齢: <input type="number" name="age" required></label>
    </div>
  </div>

  <button id="addPerson">＋追加</button>
  <button id="submitForm">送信</button>

  <script>
    const formContainer = document.getElementById("formContainer");

    document.getElementById("addPerson").addEventListener("click", () => {
      const clone = formContainer.firstElementChild.cloneNode(true);
      clone.querySelectorAll("input").forEach(input => input.value = "");
      formContainer.appendChild(clone);
    });

    document.getElementById("submitForm").addEventListener("click", () => {
      const people = Array.from(document.querySelectorAll(".person")).map(person => {
        return {
          name: person.querySelector('[name="name"]').value,
          age: person.querySelector('[name="age"]').value
        };
      });

      const json = JSON.stringify(people);
      const url = "https://script.google.com/macros/s/AKfycbygn8UW9Pl3Af4k9iYsjFfGvJUigrbcdavwFqnJamaqYk7IPLLYhQxdJ5d8Qc0KvIa9OA/exec" +
                  "?data=" + encodeURIComponent(json);


      fetch(url)
        .then(res => res.text())
        .then(msg => alert("応答: " + msg))
        .catch(err => alert("送信エラー: " + err));
    });
  </script>
</body>
</html>
